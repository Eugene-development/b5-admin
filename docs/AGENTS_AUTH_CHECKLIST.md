# –ß–µ–∫–ª–∏—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Agents

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (b5-admin)

- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å `isRefreshing` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `refreshData`
- [x] –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞ –≤ `agents.js`
- [x] –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞ –≤ `clients.js`
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–∫–µ–Ω–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
- [x] –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø—Ä–æ–±–ª–µ–º–µ

## ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (b5-api-2)

### –®–∞–≥ 1: –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

```bash
cd /var/www  # –ø—É—Ç—å –∫ b5-api-2
php artisan config:clear
php artisan cache:clear
php artisan lighthouse:clear-cache
php artisan config:cache
sudo systemctl restart php8.2-fpm
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é JWT

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env
cat .env | grep JWT

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# JWT_SECRET=...
# JWT_TTL=60
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é auth.php

```bash
cat config/auth.php | grep -A 3 "'api'"

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# 'api' => [
#     'driver' => 'jwt',
#     'provider' => 'users',
# ],
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é lighthouse.php

```bash
cat config/lighthouse.php | grep guards

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# 'guards' => ['api'],
```

## ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–ø–ª–æ–π

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
cd b5-admin
git add .
git commit -m "Fix JWT auth for agents page"
git push

# –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
```

## ‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

1. –û—Ç–∫—Ä—ã—Ç—å https://admin.bonus.band
2. –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
3. –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Console
4. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/agents`
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   - `üîÑ Refreshing agents data...`
   - `üîê [refreshUsers] Auth headers: { Authorization: "Bearer ..." }`
   - `üåê [refreshUsers] GraphQL endpoint: https://api.bonus.band/graphql`

## –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –£—Å–ø–µ—Ö

–ï—Å–ª–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –≤–∏–¥–Ω—ã –ª–æ–≥–∏ —Å —Ç–æ–∫–µ–Ω–æ–º –∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è - –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!

### ‚ö†Ô∏è –¢–æ–∫–µ–Ω –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è

–ï—Å–ª–∏ `Auth headers: {}` - –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage –≤ DevTools ‚Üí Application ‚Üí Local Storage
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–∏ —Ç–æ–∫–µ–Ω –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `getAuthToken()` –≤ `b5-admin/src/lib/api/config.js`

### ‚ö†Ô∏è –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è, –Ω–æ –æ—à–∏–±–∫–∞ 401

–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –µ—Å—Ç—å, –Ω–æ –≤—Å–µ —Ä–∞–≤–Ω–æ "Unauthenticated" - –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

- –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –®–∞–≥—É 1 (–æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Laravel: `tail -f storage/logs/laravel.log`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ JWT_SECRET –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤ b5-auth-2 –∏ b5-api-2

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `b5-admin/docs/JWT_AGENTS_AUTH_FIX.md`
- –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: `b5-admin/docs/QUICK_FIX_AGENTS_AUTH.md`
