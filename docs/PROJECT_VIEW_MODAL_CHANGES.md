# Изменения в модальном окне просмотра проекта

## Дата: 2025-11-13

## Описание изменений

В модальном окне просмотра проекта (`ProjectViewModal.svelte`) была изменена секция отображения финансовой информации.

### Было:

Отображались четыре поля в одну строку:

- **Подрядчик**: сумма контракта (contract_amount)
- **Закупка**: сумма закупки (purchase_amount)
- **Камень**: сумма на камень (stone_amount)
- **Стекло**: сумма на стекло (glass_amount)

### Стало:

Два отдельных раздела с детальной информацией:

#### 1. Раздел "Контракты"

Отображает список всех контрактов, связанных с проектом. Для каждого контракта показывается:

- Компания (название)
- Номер контракта
- Дата заключения
- Планируемое завершение (с индикатором просрочки)
- Фактическое завершение (если есть)
- Процент агента / куратора
- Статус (активен/неактивен)

Если контрактов нет, отображается сообщение "Контракты не найдены".

#### 2. Раздел "Закупки"

Подготовлен для отображения списка закупок проекта. Для каждой закупки будет показываться:

- Название
- Сумма

Если закупок нет, отображается сообщение "Закупки не найдены".

**Примечание**: Сущность "Закупки" (Purchases) пока не реализована в системе. Раздел готов к использованию после создания соответствующей таблицы и API.

## Изменения в API

### GraphQL запрос проектов

В файле `b5-admin/src/lib/api/projects.js` добавлено поле `contracts` в запрос `PROJECTS_QUERY`:

```graphql
contracts {
    id
    contract_number
    contract_date
    planned_completion_date
    actual_completion_date
    agent_percentage
    curator_percentage
    is_active
    company {
        id
        name
        legal_name
    }
}
```

### GraphQL схема проектов

В файле `b5-api-2/graphql/project.graphql` добавлено поле `contracts` в тип `Project`:

```graphql
contracts: [Contract!] @hasMany
```

## Преимущества новой структуры

1. **Детальная информация**: Пользователи видят полную информацию о каждом контракте, а не только общую сумму
2. **Множественные контракты**: Поддержка отображения нескольких контрактов для одного проекта
3. **Связь с компаниями**: Видно, с какой компанией заключен каждый контракт
4. **Статус контрактов**: Отображение активности и просрочек
5. **Расширяемость**: Легко добавить дополнительные поля или функциональность

## Следующие шаги

Для полной реализации функционала необходимо:

1. Создать таблицу `purchases` в базе данных (b5-db-2)
2. Создать модель `Purchase` в Laravel (b5-api-2)
3. Добавить GraphQL схему для закупок (b5-api-2)
4. Добавить связь `purchases` в модель `Project`
5. Обновить GraphQL запрос проектов для загрузки закупок
6. Создать страницу управления закупками в админ-панели (опционально)
