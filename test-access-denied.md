# Инструкция по тестированию функции блокировки доступа

## Подготовка к тестированию

### 1. Создание тестовых пользователей

Для полноценного тестирования необходимо создать пользователей с разными статусами:

```sql
-- Пользователь с неопределённым статусом
INSERT INTO users (name, email, password, type, email_verified) 
VALUES ('Тест Неопределённый', 'test-undefined@example.com', 'hashed_password', NULL, 1);

-- Пользователь с неразрешённым статусом
INSERT INTO users (name, email, password, type, email_verified) 
VALUES ('Тест Администратор', 'test-admin@example.com', 'hashed_password', 'Администратор', 1);

-- Пользователь со статусом "Клиент"
INSERT INTO users (name, email, password, type, email_verified) 
VALUES ('Тест Клиент', 'test-client@example.com', 'hashed_password', 'Клиент', 1);

-- Пользователь со статусом "Агент"
INSERT INTO users (name, email, password, type, email_verified) 
VALUES ('Тест Агент', 'test-agent@example.com', 'hashed_password', 'Агент', 1);

-- Пользователь со статусом "Дизайнер"
INSERT INTO users (name, email, password, type, email_verified) 
VALUES ('Тест Дизайнер', 'test-designer@example.com', 'hashed_password', 'Дизайнер', 1);
```

## Тестовые сценарии

### Тест 1: Логин со статусом "Админ"

**Шаги:**
1. Открыть страницу `/login`
2. Ввести email: `test-admin@example.com`
3. Ввести пароль
4. Нажать "Войти в систему"

**Ожидаемый результат:**
- Успешный вход в систему
- Редирект на `/dashboard` (или на страницу из параметра `returnUrl`)
- Доступ ко всем защищённым маршрутам

---

### Тест 2: Логин со статусом "Куратор"

**Шаги:**
1. Открыть страницу `/login`
2. Ввести email: `test-curator@example.com`
3. Ввести пароль
4. Нажать "Войти в систему"

**Ожидаемый результат:**
- Успешный вход в систему
- Полный доступ к функционалу

---

### Тест 3: Логин со статусом "Менеджер"

**Шаги:**
1. Открыть страницу `/login`
2. Ввести email: `test-manager@example.com`
3. Ввести пароль
4. Нажать "Войти в систему"

**Ожидаемый результат:**
- Успешный вход в систему
- Полный доступ к функционалу

---

### Тест 4: Логин со статусом "Клиент"

**Шаги:**
1. Открыть страницу `/login`
2. Ввести email: `test-client@example.com`
3. Ввести пароль
4. Нажать "Войти в систему"

**Ожидаемый результат:**
- Редирект на `/access-denied`
- Отображается агрессивная страница с предупреждением
- Видны кнопки "ВЫЙТИ ИЗ СИСТЕМЫ" и "СВЯЗАТЬСЯ С ПОДДЕРЖКОЙ"

---

### Тест 5: Логин с неопределённым статусом

**Шаги:**
1. Открыть страницу `/login`
2. Ввести email: `test-undefined@example.com` (пользователь с `type: null`)
3. Ввести пароль
4. Нажать "Войти в систему"

**Ожидаемый результат:**
- Редирект на `/access-denied`
- Доступ запрещён (статус не входит в список разрешённых)

---

### Тест 6: Прямой доступ к защищённым маршрутам

**Шаги:**
1. Войти в систему с пользователем с неразрешённым статусом
2. В адресной строке ввести `/dashboard`
3. Нажать Enter

**Ожидаемый результат:**
- Редирект на `/access-denied`
- Невозможность обойти проверку статуса

---

### Тест 7: Проверка кнопки "ВЫЙТИ ИЗ СИСТЕМЫ"

**Шаги:**
1. Находясь на странице `/access-denied`
2. Нажать кнопку "ВЫЙТИ ИЗ СИСТЕМЫ"

**Ожидаемый результат:**
- Выход из системы
- Редирект на `/login`
- Очистка токена авторизации

---

### Тест 8: Проверка кнопки "СВЯЗАТЬСЯ С ПОДДЕРЖКОЙ"

**Шаги:**
1. Находясь на странице `/access-denied`
2. Нажать кнопку "СВЯЗАТЬСЯ С ПОДДЕРЖКОЙ"

**Ожидаемый результат:**
- Открывается почтовый клиент
- В поле "Кому" указан адрес: `support@b5.ru`

---

### Тест 9: Проверка анимаций

**Шаги:**
1. Открыть страницу `/access-denied`
2. Наблюдать за анимациями

**Ожидаемый результат:**
- Пульсирующая иконка предупреждения
- Анимированный фон с полосами
- Плавное появление элементов
- Эффекты при наведении на кнопки

---

### Тест 10: Адаптивность

**Шаги:**
1. Открыть страницу `/access-denied`
2. Изменить размер окна браузера (мобильный, планшет, десктоп)

**Ожидаемый результат:**
- Корректное отображение на всех разрешениях
- Кнопки адаптируются под размер экрана
- Текст остаётся читаемым

---

## Проверка в консоли браузера

### Проверка данных пользователя

Откройте консоль браузера (F12) и выполните:

```javascript
// Проверить текущего пользователя
console.log(localStorage.getItem('b5_admin_user_data'));

// Проверить токен
console.log(localStorage.getItem('b5_admin_auth_token'));
```

### Ручная установка статуса для тестирования

```javascript
// Получить текущего пользователя
const userData = JSON.parse(localStorage.getItem('b5_admin_user_data'));

// Изменить статус
userData.type = 'Неизвестный';

// Сохранить обратно
localStorage.setItem('b5_admin_user_data', JSON.stringify(userData));

// Перезагрузить страницу
location.reload();
```

## Чек-лист тестирования

- [ ] Тест 1: Неопределённый статус - PASSED
- [ ] Тест 2: Неразрешённый статус - PASSED
- [ ] Тест 3: Статус "Клиент" - PASSED
- [ ] Тест 4: Статус "Агент" - PASSED
- [ ] Тест 5: Статус "Дизайнер" - PASSED
- [ ] Тест 6: Прямой доступ - PASSED
- [ ] Тест 7: Кнопка выхода - PASSED
- [ ] Тест 8: Кнопка поддержки - PASSED
- [ ] Тест 9: Анимации - PASSED
- [ ] Тест 10: Адаптивность - PASSED

## Известные проблемы

Если обнаружены проблемы, запишите их здесь:

1. 
2. 
3. 

## Примечания

- Убедитесь, что API возвращает поле `type` в объекте пользователя
- Проверьте, что значения статусов в БД точно соответствуют: "Клиент", "Агент", "Дизайнер" (с заглавной буквы)
- При изменении списка разрешённых статусов обновите проверки в `login/+page.svelte` и `auth-guard.svelte.js`
