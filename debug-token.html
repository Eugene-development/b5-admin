<!DOCTYPE html>
<html>
<head>
    <title>Debug Token</title>
</head>
<body>
    <h1>Token Debug Info</h1>
    <pre id="output"></pre>
    <script>
        const token = localStorage.getItem('b5_auth_token');
        const userData = localStorage.getItem('b5_admin_user_data');

        const output = {
            hasToken: !!token,
            tokenLength: token ? token.length : 0,
            tokenPreview: token ? token.substring(0, 50) + '...' : 'No token',
            userData: userData ? JSON.parse(userData) : 'No user data',
            allLocalStorageKeys: Object.keys(localStorage)
        };

        // Try to decode JWT if it exists
        if (token) {
            try {
                // Handle if token is JSON string
                let actualToken = token;
                try {
                    const parsed = JSON.parse(token);
                    actualToken = parsed.access_token || parsed.token || token;
                } catch(e) {
                    // Token is already a string
                }

                // Decode JWT payload
                const parts = actualToken.split('.');
                if (parts.length === 3) {
                    const payload = JSON.parse(atob(parts[1]));
                    output.jwtPayload = payload;
                    output.tokenExpiry = payload.exp ? new Date(payload.exp * 1000).toISOString() : 'No expiry';
                    output.tokenExpired = payload.exp ? Date.now() > payload.exp * 1000 : 'Unknown';
                    output.currentTime = new Date().toISOString();
                }
            } catch (e) {
                output.jwtDecodeError = e.message;
            }
        }

        document.getElementById('output').textContent = JSON.stringify(output, null, 2);
    </script>
</body>
</html>
